---
title: Sandbox Environment
description: Learn about the cloud sandbox environments that Terragon provides for running your code.
---

import { Callout } from "fumadocs-ui/components/callout";
import {
  Tabs,
  TabsList,
  TabsTrigger,
  TabsContent,
} from "fumadocs-ui/components/tabs";
import { CircleCheckBig } from "lucide-react";

## Sandbox Specifications

When Terragon runs your code, it uses cloud sandboxes with:

<CircleCheckBig className="inline h-4 w-4 mr-1 text-green-600" /> **2 CPU
cores**

<CircleCheckBig className="inline h-4 w-4 mr-1 text-green-600" /> **4 GB RAM**

<CircleCheckBig className="inline h-4 w-4 mr-1 text-green-600" /> **20 GB disk
space**

<CircleCheckBig className="inline h-4 w-4 mr-1 text-green-600" /> **Ubuntu
24.04**

<CircleCheckBig className="inline h-4 w-4 mr-1 text-green-600" /> **Latest
version of Claude Code CLI**

<CircleCheckBig className="inline h-4 w-4 mr-1 text-green-600" /> **Latest
version of Codex CLI**

## Pre-installed Tools

The sandbox environment includes a comprehensive set of development tools:

### Languages

- Python 3
- Node.js 22
- PHP
- Bun
- Rust

### Package Managers

- npm
- pnpm
- bun
- pip
- Composer (PHP)
- cargo

### Development Tools

- GCC compiler
- Docker CE (with docker-compose and buildx)
- GitHub CLI (gh)
- curl, unzip, gnupg, and other utilities

## Sandbox Customization

You can customize the tools available in your sandbox by configuring custom [setup scripts](/docs/configuration/environment-setup/setup-scripts).

## Sandbox Terminal

You can open an terminal connected directly to your task's sandbox for debugging purposes. Access this from the `...` menu at the top of each tasks.

This is useful for:

- Debugging issues in the sandbox environment
- Inspecting the state of your code and dependencies
- Running ad-hoc commands

## Preview Security Contracts (Internal)

Preview routing is API-only:

- `/api/internal/preview/*`
- `/api/preview/*`

No dedicated preview page routes are added under `apps/www/src/app/**/page.tsx`.

### Preview Config and Lifecycle

- Preview startup requires explicit config (`command`, `port`, `healthPath`, `requiresWebsocket`).
- Missing or invalid config resolves to `unsupported` with `missing_config`.
- Session lifecycle is deterministic: `pending -> initializing -> ready|unsupported|error`.
- Route-level feature-flag gating returns `404` when `sandboxPreview` is disabled.

### Token and Keystore Rules

- Bootstrap/exchange/cookie/origin tokens are HS256 JWTs with `kid`.
- Key material is namespaced per audience (`exchange`, `broadcast`, `cookie`, `origin`).
- Active/previous key pointers (`active_kid`, `prev_kid`) support rotation grace windows.
- Replay protection is enforced with single-use cache keys (`jti`/`nonce`).
- Cache outage behavior is fail-closed (`cache_unavailable` + retry payload), including exchange/proxy/subscription paths.

### Proxy Hardening

- Proxy enforces origin binding, revocation-version checks, SSRF/private IP blocking, path normalization, and header allowlists.
- `proxyReqId` is attached to responses for request tracing.
- WebSocket-required previews return `501` with `ws_required`; SSE uses no-cache streaming headers.
- Canonical denied/security reason enums live in `packages/shared/src/types/preview.ts`.

### Repo Access Cache Contract

- Key: `terragon:v1:preview:repo-access:{env}:{userId}:{repoFullName}`.
- Positive TTL: `min(60s, previewSessionTTLSeconds)`.
- Negative TTL: `5s`.
- Invalidation helper: `invalidateRepoAccess(userId, repoFullName, reason)`.

### Daemon + Validation Correlation

- Canonical propagation path: `startAgentMessage -> sendDaemonMessage -> daemon envelope v2 -> /api/daemon-event`.
- Mixed payload versions for one run are quarantined (`payload_version_mismatch`).
- Missing terminal `endSha` is quarantined; maintenance sweeps stale runs every minute.
- If terminal SHA cannot be trusted against sandbox HEAD, validation falls back to `working-tree-fallback`.

### Naming Guidance

Use canonical `codesandboxId` in persisted payloads and contracts. If `sandboxInstanceId` aliases are used in UI/helpers, convert through shared utility paths only (no ad-hoc aliasing).
